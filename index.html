<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XandY Daily Schedule Generator 6 & 7</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            margin-top: 30px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .logo {
            max-width: 120px;
            margin-bottom: 10px;
        }
        h1 {
            color: #333;
            margin: 0;
            font-size: 28px;
        }
        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .form-group {
            flex: 1;
            min-width: 250px;
            margin-right: 20px;
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        input[type="date"] {
            font-family: inherit;
        }
        .button-row {
            display: flex;
            justify-content: center;
            margin-top: 30px;
            gap: 15px;
        }
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        #generate-btn {
            background-color: #3f51b5;
            color: white;
        }
        #generate-btn:hover {
            background-color: #303f9f;
        }
        #reset-btn {
            background-color: #f44336;
            color: white;
        }
        #reset-btn:hover {
            background-color: #d32f2f;
        }
        .preview-container {
            margin-top: 30px;
            display: none;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
        }
        .preview-title {
            text-align: center;
            margin-bottom: 20px;
            color: #333;
        }
        #schedule-preview {
            max-width: 100%;
            display: block;
            margin: 0 auto;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            border-radius: 4px;
        }
        .download-row {
            text-align: center;
            margin-top: 20px;
        }
        #download-btn {
            background-color: #4caf50;
            color: white;
        }
        #download-btn:hover {
            background-color: #388e3c;
        }
        .custom-topic-container {
            display: none;
            margin-top: 10px;
        }
        #topic-type-select {
            margin-bottom: 10px;
        }
        #custom-topic-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        .template-selection {
            margin-bottom: 20px;
        }
        .template-preview {
            max-width: 200px;
            margin-top: 10px;
            border: 2px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .template-preview:hover {
            border-color: #3f51b5;
            box-shadow: 0 0 10px rgba(63, 81, 181, 0.3);
        }
        .template-preview.selected {
            border-color: #3f51b5;
            box-shadow: 0 0 15px rgba(63, 81, 181, 0.5);
        }
        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .template-option {
            text-align: center;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .template-option:hover {
            border-color: #3f51b5;
            background-color: #f8f9ff;
        }
        .template-option.selected {
            border-color: #3f51b5;
            background-color: #e8eaf6;
        }
        .template-name {
            font-weight: 600;
            margin-top: 10px;
            color: #333;
        }
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
            color: #666;
        }
        .form-section {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }
        .form-section.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #3f51b5;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 2px solid #e8eaf6;
        }
        .date-range-group {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        .date-range-group .form-group {
            margin-right: 0;
        }
        .date-separator {
            font-weight: 600;
            color: #666;
            margin: 0 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="https://raw.githubusercontent.com/Arja-P/XandY-Schedule-Generator/main/images/XandY logo.png" alt="X and Y Learning" class="logo">
            <h1>Daily Schedule Generator</h1>
        </div>

        <!-- Template Selection Section -->
        <div class="form-row template-selection">
            <div class="form-group" style="flex: 1; margin-right: 0;">
                <label>Select Template</label>
                <div class="template-grid" id="template-grid">
                    <!-- Templates will be loaded here -->
                </div>
                <div class="loading" id="template-loading">Loading templates...</div>
            </div>
        </div>

        <!-- Daily Schedule Form -->
        <div class="form-section active" id="dailyschedule-form">
            <div class="section-title">Daily Schedule Details</div>
            <div class="form-row">
                <div class="form-group">
                    <label for="ds-class-select">Class</label>
                    <select id="ds-class-select" required>
                        <option value="">Select Class</option>
                        <option value="06">06</option>
                        <option value="07">07</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="ds-board-select">Board</label>
                    <select id="ds-board-select" required>
                        <option value="">Select Board</option>
                        <option value="State">State</option>
                        <option value="CBSE">CBSE</option>
                        <option value="GCC">GCC</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="ds-subject-select">Subject</label>
                    <select id="ds-subject-select" required>
                        <option value="">Select Subject</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="ds-chapter-input">Chapter Name</label>
                    <input type="text" id="ds-chapter-input" placeholder="Enter chapter name" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="ds-topic-select">Topic</label>
                    <select id="ds-topic-select" required>
                        <option value="CUSTOM">Custom Topic</option>
                        <option value="LIVE CLASS">LIVE CLASS</option>
                        <option value="WORKBOOK DAY">WORKBOOK DAY</option>
                        <option value="LIVE CLASS & WORK BOOK DAY">LIVE CLASS & WORK BOOK DAY</option>
                    </select>
                    <div class="custom-topic-container" id="ds-custom-topic-container" style="display: block;">
                        <input type="text" id="ds-custom-topic-input" placeholder="Enter custom topic" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="ds-date-input">Date</label>
                    <input type="date" id="ds-date-input" required>
                </div>
            </div>
        </div>

        <!-- Exam Form -->
        <div class="form-section" id="exam-form">
            <div class="section-title">Exam Details</div>
            <div class="form-row">
                <div class="form-group">
                    <label for="ex-class-select">Class</label>
                    <select id="ex-class-select" required>
                        <option value="">Select Class</option>
                        <option value="06">06</option>
                        <option value="07">07</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="ex-board-select">Board</label>
                    <select id="ex-board-select" required>
                        <option value="">Select Board</option>
                        <option value="State">State</option>
                        <option value="CBSE">CBSE</option>
                        <option value="GCC">GCC</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="ex-subject-select">Subject</label>
                    <select id="ex-subject-select" required>
                        <option value="">Select Subject</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="ex-chapter-input">Chapter Name</label>
                    <input type="text" id="ex-chapter-input" placeholder="Enter chapter name" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="ex-date-input">Date</label>
                    <input type="date" id="ex-date-input" required>
                </div>
                <div class="form-group">
                    <label for="ex-questions-input">Total Questions</label>
                    <input type="number" id="ex-questions-input" placeholder="e.g., 50" min="1" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="ex-duration-input">Duration (minutes)</label>
                    <input type="number" id="ex-duration-input" placeholder="e.g., 90" min="1" required>
                </div>
            </div>
        </div>

        <!-- New Content Form -->
        <div class="form-section" id="newcontent-form">
            <div class="section-title">New Chapter Details</div>
            <div class="form-row">
                <div class="form-group">
                    <label for="nc-class-select">Class</label>
                    <select id="nc-class-select" required>
                        <option value="">Select Class</option>
                        <option value="06">06</option>
                        <option value="07">07</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="nc-board-select">Board</label>
                    <select id="nc-board-select" required>
                        <option value="">Select Board</option>
                        <option value="State">State</option>
                        <option value="CBSE">CBSE</option>
                        <option value="GCC">GCC</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="nc-subject-select">Subject</label>
                    <select id="nc-subject-select" required>
                        <option value="">Select Subject</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="nc-chapter-input">Chapter Name</label>
                    <input type="text" id="nc-chapter-input" placeholder="Enter chapter name" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="nc-date-input">Date</label>
                    <input type="date" id="nc-date-input" required>
                </div>
            </div>
        </div>

        <!-- Workbook Form -->
        <div class="form-section" id="workbook-form">
            <div class="section-title">Workbook Details</div>
            <div class="form-row">
                <div class="form-group">
                    <label for="wb-class-select">Class</label>
                    <select id="wb-class-select" required>
                        <option value="">Select Class</option>
                        <option value="06">06</option>
                        <option value="07">07</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="wb-board-select">Board</label>
                    <select id="wb-board-select" required>
                        <option value="">Select Board</option>
                        <option value="State">State</option>
                        <option value="CBSE">CBSE</option>
                        <option value="GCC">GCC</option>
                    </select>
                </div>
            </div>
            <div class="form-row date-range-group">
                <div class="form-group">
                    <label for="wb-start-date">From Date</label>
                    <input type="date" id="wb-start-date" required>
                </div>
                <div class="date-separator">to</div>
                <div class="form-group">
                    <label for="wb-end-date">To Date</label>
                    <input type="date" id="wb-end-date" required>
                </div>
            </div>
        </div>

        <!-- Live Class Form -->
        <div class="form-section" id="live-form">
            <div class="section-title">Live Class Details</div>
            <div class="form-row">
                <div class="form-group">
                    <label for="lv-class-select">Class</label>
                    <select id="lv-class-select" required>
                        <option value="">Select Class</option>
                        <option value="06">06</option>
                        <option value="07">07</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="lv-board-select">Board</label>
                    <select id="lv-board-select" required>
                        <option value="">Select Board</option>
                        <option value="State">State</option>
                        <option value="CBSE">CBSE</option>
                        <option value="GCC">GCC</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="lv-subject-select">Subject</label>
                    <select id="lv-subject-select" required>
                        <option value="">Select Subject</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="lv-chapter-input">Chapter Name</label>
                    <input type="text" id="lv-chapter-input" placeholder="Enter chapter name" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="lv-topic-input">Topic</label>
                    <input type="text" id="lv-topic-input" placeholder="Enter topic" required>
                </div>
                <div class="form-group">
                    <label for="lv-date-input">Date</label>
                    <input type="date" id="lv-date-input" required>
                </div>
            </div>
        </div>

        <!-- Study Leave Form -->
        <div class="form-section" id="studyleave-form">
            <div class="section-title">Study Leave Details</div>
            <div class="form-row">
                <div class="form-group">
                    <label for="sl-class-select">Class</label>
                    <select id="sl-class-select" required>
                        <option value="">Select Class</option>
                        <option value="06">06</option>
                        <option value="07">07</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="sl-board-select">Board</label>
                    <select id="sl-board-select" required>
                        <option value="">Select Board</option>
                        <option value="State">State</option>
                        <option value="CBSE">CBSE</option>
                        <option value="GCC">GCC</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="sl-date-input">Date</label>
                    <input type="date" id="sl-date-input" required>
                </div>
            </div>
        </div>

        <div class="button-row">
            <button type="button" id="generate-btn">Generate Schedule</button>
            <button type="button" id="reset-btn">Reset Form</button>
        </div>

        <div class="preview-container" id="preview-container">
            <h2 class="preview-title">Preview</h2>
            <canvas id="schedule-preview"></canvas>
            <div class="download-row">
                <button type="button" id="download-btn">Download Schedule</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Set today's date as default for all date inputs
            const today = new Date();
            const dateString = today.toISOString().split('T')[0];
            const dateInputs = document.querySelectorAll('input[type="date"]');
            dateInputs.forEach(input => {
                input.value = dateString;
            });
            
            // Initialize elements
            const generateBtn = document.getElementById('generate-btn');
            const resetBtn = document.getElementById('reset-btn');
            const previewContainer = document.getElementById('preview-container');
            const schedulePreview = document.getElementById('schedule-preview');
            const downloadBtn = document.getElementById('download-btn');
            const templateGrid = document.getElementById('template-grid');
            const templateLoading = document.getElementById('template-loading');
            
            // Predefined templates with their configurations
            const predefinedTemplates = [
                {
                    id: 'dailyschedule',
                    name: 'DAILY SCHEDULE',
                    url: 'https://raw.githubusercontent.com/Arja-P/XandY-Schedule-Generator-6th-7th/main/templates/dailyschedule.png',
                    coordinates: {
                        courseBatch: { x: 900, y: 225, align: 'right', fontSize: 60, color: '#3F51B5' },
                        date: { x: 575, y: 450, align: 'center', fontSize: 50, color: '#FFFFFF' },
                        subject: { x: 245, y: 645, align: 'center', fontSize: 40, color: '#FFFFFF' },
                        chapter: { x: 550, y: 720, align: 'center', maxWidth: 670, maxHeight: 120, fontSize: 55, color: '#FFFFFF' },
                        topic: { x: 550, y: 860, align: 'center', maxWidth: 670, maxHeight: 120, fontSize: 40, color: '#FFD54F' }
                    }
                },
                {
                    id: 'exam',
                    name: 'EXAM',
                    url: 'https://raw.githubusercontent.com/Arja-P/XandY-Schedule-Generator-6th-7th/main/templates/exam.png',
                    coordinates: {
                        courseBatch: { x: 800, y: 200, align: 'right', fontSize: 55, color: '#4CAF50' },
                        date: { x: 540, y: 400, align: 'center', fontSize: 45, color: '#FFFFFF' },
                        subject: { x: 200, y: 600, align: 'center', fontSize: 38, color: '#FFFFFF' },
                        chapter: { x: 540, y: 680, align: 'center', maxWidth: 650, maxHeight: 110, fontSize: 50, color: '#FFFFFF' },
                        examDetails: { x: 540, y: 820, align: 'center', maxWidth: 650, maxHeight: 110, fontSize: 38, color: '#81C784' }
                    }
                },
                {
                    id: 'newcontent',
                    name: 'NEW CHAPTER',
                    url: 'https://raw.githubusercontent.com/Arja-P/XandY-Schedule-Generator-6th-7th/main/templates/newcontent.png',
                    coordinates: {
                        courseBatch: { x: 850, y: 180, align: 'right', fontSize: 58, color: '#FF5722' },
                        date: { x: 540, y: 380, align: 'center', fontSize: 48, color: '#FFFFFF' },
                        subject: { x: 270, y: 580, align: 'center', fontSize: 42, color: '#FFFFFF' },
                        chapter: { x: 540, y: 660, align: 'center', maxWidth: 680, maxHeight: 130, fontSize: 52, color: '#FFFFFF' },
                        newChapter: { x: 540, y: 800, align: 'center', maxWidth: 680, maxHeight: 130, fontSize: 42, color: '#FFB74D' }
                    }
                },
                {
                    id: 'workbook',
                    name: 'WORK BOOK',
                    url: 'https://raw.githubusercontent.com/Arja-P/XandY-Schedule-Generator-6th-7th/main/templates/workbook.png',
                    coordinates: {
                        courseBatch: { x: 880, y: 210, align: 'right', fontSize: 62, color: '#9C27B0' },
                        dateRange: { x: 540, y: 420, align: 'center', fontSize: 52, color: '#FFFFFF' },
                        workbookText: { x: 540, y: 700, align: 'center', maxWidth: 660, maxHeight: 125, fontSize: 54, color: '#FFFFFF' }
                    }
                },
                {
                    id: 'live',
                    name: 'LIVE CLASS',
                    url: 'https://raw.githubusercontent.com/Arja-P/XandY-Schedule-Generator-6th-7th/main/templates/live.png',
                    coordinates: {
                        courseBatch: { x: 820, y: 190, align: 'right', fontSize: 56, color: '#F44336' },
                        date: { x: 540, y: 390, align: 'center', fontSize: 46, color: '#212121' },
                        subject: { x: 250, y: 590, align: 'center', fontSize: 40, color: '#212121' },
                        chapter: { x: 540, y: 670, align: 'center', maxWidth: 640, maxHeight: 115, fontSize: 48, color: '#212121' },
                        topic: { x: 540, y: 810, align: 'center', maxWidth: 640, maxHeight: 115, fontSize: 40, color: '#F44336' }
                    }
                },
                {
                    id: 'studyleave',
                    name: 'STUDY LEAVE',
                    url: 'https://raw.githubusercontent.com/Arja-P/XandY-Schedule-Generator-6th-7th/main/templates/studyleave.png',
                    coordinates: {
                        courseBatch: { x: 820, y: 190, align: 'right', fontSize: 56, color: '#F44336' },
                        date: { x: 540, y: 390, align: 'center', fontSize: 46, color: '#212121' },
                        studyLeaveText: { x: 540, y: 670, align: 'center', maxWidth: 640, maxHeight: 115, fontSize: 48, color: '#212121' }
                    }
                }
            ];
            
            let selectedTemplate = predefinedTemplates[0]; // Default to first template
            let loadedTemplateImages = new Map();
            
            // Subject mapping by class
            const subjectsByClass = {
                '06': ['Math', 'Physics', 'Chemistry', 'Biology'],
                '07': ['Math', 'Physics', 'Chemistry', 'Biology']
            };

            // Form sections mapping
            const formSections = {
                'dailyschedule': 'dailyschedule-form',
                'exam': 'exam-form',
                'newcontent': 'newcontent-form',
                'workbook': 'workbook-form',
                'live': 'live-form',
                'studyleave': 'studyleave-form'
            };

            // Load predefined templates
            function loadTemplates() {
                templateLoading.style.display = 'block';
                let loadedCount = 0;
                const totalTemplates = predefinedTemplates.length;
                
                predefinedTemplates.forEach((template, index) => {
                    const img = new Image();
                    img.crossOrigin = 'anonymous';
                    
                    img.onload = function() {
                        loadedTemplateImages.set(template.id, img);
                        loadedCount++;
                        
                        const templateOption = document.createElement('div');
                        templateOption.className = 'template-option';
                        templateOption.dataset.templateId = template.id;
                        
                        if (index === 0) {
                            templateOption.classList.add('selected');
                        }
                        
                        templateOption.innerHTML = `
                            <img src="${template.url}" alt="${template.name}" class="template-preview">
                            <div class="template-name">${template.name}</div>
                        `;
                        
                        templateOption.addEventListener('click', function() {
                            document.querySelectorAll('.template-option').forEach(opt => {
                                opt.classList.remove('selected');
                            });
                            
                            this.classList.add('selected');
                            selectedTemplate = predefinedTemplates.find(t => t.id === this.dataset.templateId);
                            showFormSection(selectedTemplate.id);
                        });
                        
                        templateGrid.appendChild(templateOption);
                        
                        if (loadedCount === totalTemplates) {
                            templateLoading.style.display = 'none';
                        }
                    };
                    
                    img.onerror = function() {
                        console.error(`Failed to load template: ${template.name}`);
                        loadedCount++;
                        
                        const templateOption = document.createElement('div');
                        templateOption.className = 'template-option';
                        templateOption.dataset.templateId = template.id;
                        templateOption.style.backgroundColor = '#f0f0f0';
                        templateOption.innerHTML = `
                            <div style="height: 150px; display: flex; align-items: center; justify-content: center; color: #666;">
                                Template Not Available
                            </div>
                            <div class="template-name">${template.name}</div>
                        `;
                        
                        templateOption.addEventListener('click', function() {
                            document.querySelectorAll('.template-option').forEach(opt => {
                                opt.classList.remove('selected');
                            });
                            
                            this.classList.add('selected');
                            selectedTemplate = predefinedTemplates.find(t => t.id === this.dataset.templateId);
                            showFormSection(selectedTemplate.id);
                        });
                        
                        templateGrid.appendChild(templateOption);
                        
                        if (loadedCount === totalTemplates) {
                            templateLoading.style.display = 'none';
                        }
                    };
                    
                    img.src = template.url;
                });
            }

            // Show appropriate form section based on template
            function showFormSection(templateId) {
                document.querySelectorAll('.form-section').forEach(section => {
                    section.classList.remove('active');
                });
                
                const sectionId = formSections[templateId];
                if (sectionId) {
                    document.getElementById(sectionId).classList.add('active');
                }
            }

            // Initialize all class selectors
            function initializeClassSelectors() {
                const classSelectors
			if (!document.getElementById('subject-select').value) {
                            alert('Please select a subject!');
                            return false;
                        }
                        if (!document.getElementById('chapter-input').value.trim()) {
                            alert('Please enter a chapter name!');
                            return false;
                        }
                        if (!document.getElementById('date-input').value) {
                            alert('Please select a date!');
                            return false;
                        }
                        if (topicSelect.value === 'CUSTOM' && !customTopicInput.value.trim()) {
                            alert('Please enter a custom topic!');
                            return false;
                        }
                        break;
                        
                    case 'exam':
                        if (!document.getElementById('exam-subject-select').value) {
                            alert('Please select a subject!');
                            return false;
                        }
                        if (!document.getElementById('exam-chapter-input').value.trim()) {
                            alert('Please enter a chapter name!');
                            return false;
                        }
                        if (!document.getElementById('exam-date-input').value) {
                            alert('Please select a date!');
                            return false;
                        }
                        if (!document.getElementById('exam-questions-input').value) {
                            alert('Please enter total questions!');
                            return false;
                        }
                        if (!document.getElementById('exam-duration-input').value) {
                            alert('Please enter exam duration!');
                            return false;
                        }
                        break;
                        
                    case 'newcontent':
                        if (!document.getElementById('newcontent-subject-select').value) {
                            alert('Please select a subject!');
                            return false;
                        }
                        if (!document.getElementById('newcontent-chapter-input').value.trim()) {
                            alert('Please enter a chapter name!');
                            return false;
                        }
                        if (!document.getElementById('newcontent-date-input').value) {
                            alert('Please select a date!');
                            return false;
                        }
                        break;
                        
                    case 'workbook':
                        if (!document.getElementById('workbook-subject-select').value) {
                            alert('Please select a subject!');
                            return false;
                        }
                        if (!document.getElementById('workbook-chapter-input').value.trim()) {
                            alert('Please enter a chapter name!');
                            return false;
                        }
                        if (!document.getElementById('workbook-start-date').value) {
                            alert('Please select start date!');
                            return false;
                        }
                        if (!document.getElementById('workbook-end-date').value) {
                            alert('Please select end date!');
                            return false;
                        }
                        // Validate date range
                        const startDate = new Date(document.getElementById('workbook-start-date').value);
                        const endDate = new Date(document.getElementById('workbook-end-date').value);
                        if (startDate >= endDate) {
                            alert('End date must be after start date!');
                            return false;
                        }
                        break;
                        
                    case 'live':
                        if (!document.getElementById('live-subject-select').value) {
                            alert('Please select a subject!');
                            return false;
                        }
                        if (!document.getElementById('live-chapter-input').value.trim()) {
                            alert('Please enter a chapter name!');
                            return false;
                        }
                        if (!document.getElementById('live-topic-input').value.trim()) {
                            alert('Please enter a topic!');
                            return false;
                        }
                        if (!document.getElementById('live-date-input').value) {
                            alert('Please select a date!');
                            return false;
                        }
                        break;
                        
                    case 'studyleave':
                        if (!document.getElementById('studyleave-date-input').value) {
                            alert('Please select a date!');
                            return false;
                        }
                        break;
                        
                    default:
                        alert('Please select a valid template!');
                        return false;
                }
                
                return true;
            }

            // Generate schedule image
            function generateScheduleImage() {
                const canvas = schedulePreview;
                const ctx = canvas.getContext('2d');
                
                // Set canvas size
                canvas.width = 1080;
                canvas.height = 1080;
                
                // Get template image
                const templateImg = loadedTemplateImages.get(selectedTemplate.id);
                if (!templateImg) {
                    alert('Template image not loaded. Please try again.');
                    return;
                }
                
                // Draw template background
                ctx.drawImage(templateImg, 0, 0, canvas.width, canvas.height);
                
                // Get form data based on template
                const formData = getFormDataForTemplate();
                
                // Draw text on canvas
                drawTextOnCanvas(ctx, formData);
            }

            // Get form data based on selected template
            function getFormDataForTemplate() {
                const templateId = selectedTemplate.id;
                const classValue = classSelect.value;
                const boardValue = document.getElementById('board-select').value;
                const courseBatch = `${classValue} ${boardValue}`;
                
                const baseData = {
                    courseBatch: courseBatch
                };
                
                switch (templateId) {
                    case 'dailyschedule':
                        return {
                            ...baseData,
                            date: formatDate(document.getElementById('date-input').value),
                            subject: document.getElementById('subject-select').value,
                            chapter: document.getElementById('chapter-input').value,
                            topic: topicSelect.value === 'CUSTOM' ? customTopicInput.value : topicSelect.value
                        };
                        
                    case 'exam':
                        const questions = document.getElementById('exam-questions-input').value;
                        const duration = document.getElementById('exam-duration-input').value;
                        return {
                            ...baseData,
                            date: formatDate(document.getElementById('exam-date-input').value),
                            subject: document.getElementById('exam-subject-select').value,
                            chapter: document.getElementById('exam-chapter-input').value,
                            examInfo: `${questions} Questions | ${duration} Minutes`
                        };
                        
                    case 'newcontent':
                        return {
                            ...baseData,
                            date: formatDate(document.getElementById('newcontent-date-input').value),
                            subject: document.getElementById('newcontent-subject-select').value,
                            chapter: document.getElementById('newcontent-chapter-input').value
                        };
                        
                    case 'workbook':
                        const startDate = formatDate(document.getElementById('workbook-start-date').value);
                        const endDate = formatDate(document.getElementById('workbook-end-date').value);
                        return {
                            ...baseData,
                            dateRange: `${startDate} to ${endDate}`,
                            subject: document.getElementById('workbook-subject-select').value,
                            chapter: document.getElementById('workbook-chapter-input').value
                        };
                        
                    case 'live':
                        return {
                            ...baseData,
                            date: formatDate(document.getElementById('live-date-input').value),
                            subject: document.getElementById('live-subject-select').value,
                            chapter: document.getElementById('live-chapter-input').value,
                            topic: document.getElementById('live-topic-input').value
                        };
                        
                    case 'studyleave':
                        return {
                            ...baseData,
                            date: formatDate(document.getElementById('studyleave-date-input').value)
                        };
                        
                    default:
                        return baseData;
                }
            }

            // Format date to readable format
            function formatDate(dateString) {
                const date = new Date(dateString);
                const options = { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                };
                return date.toLocaleDateString('en-US', options);
            }

            // Draw text on canvas with proper positioning and styling
            function drawTextOnCanvas(ctx, data) {
                const coords = selectedTemplate.coordinates;
                
                // Set font properties
                ctx.textBaseline = 'middle';
                ctx.font = 'bold 40px Arial, sans-serif';
                
                // Draw each text element according to template coordinates
                Object.keys(coords).forEach(key => {
                    if (data[key]) {
                        const coord = coords[key];
                        const text = data[key];
                        
                        // Set font size and color
                        ctx.font = `bold ${coord.fontSize}px Arial, sans-serif`;
                        ctx.fillStyle = coord.color;
                        
                        // Set text alignment
                        ctx.textAlign = coord.align || 'left';
                        
                        // Handle text with max width/height constraints
                        if (coord.maxWidth && coord.maxHeight) {
                            drawMultilineText(ctx, text, coord.x, coord.y, coord.maxWidth, coord.maxHeight, coord.fontSize);
                        } else {
                            ctx.fillText(text, coord.x, coord.y);
                        }
                    }
                });
            }

            // Draw multiline text within specified bounds
            function drawMultilineText(ctx, text, x, y, maxWidth, maxHeight, fontSize) {
                const words = text.split(' ');
                const lines = [];
                let currentLine = '';
                
                // Break text into lines
                for (let i = 0; i < words.length; i++) {
                    const testLine = currentLine + words[i] + ' ';
                    const metrics = ctx.measureText(testLine);
                    const testWidth = metrics.width;
                    
                    if (testWidth > maxWidth && i > 0) {
                        lines.push(currentLine.trim());
                        currentLine = words[i] + ' ';
                    } else {
                        currentLine = testLine;
                    }
                }
                lines.push(currentLine.trim());
                
                // Calculate line height and starting Y position
                const lineHeight = fontSize * 1.2;
                const totalHeight = lines.length * lineHeight;
                const startY = y - (totalHeight / 2) + (lineHeight / 2);
                
                // Draw each line
                lines.forEach((line, index) => {
                    const lineY = startY + (index * lineHeight);
                    ctx.fillText(line, x, lineY);
                });
            }

            // Scroll to element smoothly
            function scrollToElement(element) {
                element.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            }

            // Download generated schedule
            downloadBtn.addEventListener('click', function() {
                const canvas = schedulePreview;
                const templateName = selectedTemplate.name.replace(/\s+/g, '_');
                const classValue = classSelect.value;
                const boardValue = document.getElementById('board-select').value;
                const date = new Date().toISOString().split('T')[0];
                
                const filename = `${templateName}_Class${classValue}_${boardValue}_${date}.png`;
                
                // Create download link
                const link = document.createElement('a');
                link.download = filename;
                link.href = canvas.toDataURL('image/png');
                
                // Trigger download
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            });

            // Initialize the application
            loadTemplates();
            
            // Set workbook end date automatically when start date changes
            document.getElementById('workbook-start-date').addEventListener('change', function() {
                const startDate = new Date(this.value);
                if (!isNaN(startDate.getTime())) {
                    // Set end date to 7 days after start date by default
                    const endDate = new Date(startDate);
                    endDate.setDate(startDate.getDate() + 7);
                    document.getElementById('workbook-end-date').value = endDate.toISOString().split('T')[0];
                }
            });
        });
    </script>
</body>
</html>
